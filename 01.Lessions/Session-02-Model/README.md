# Session 02 - Databases and Model

Trong ch∆∞∆°ng n√†y ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ `M`, th√†nh ph·∫ßn ƒë·∫ßu ti√™n trong m√¥ h√¨nh `MVT`

## üíõ C·∫•u h√¨nh k·∫øt n·ªëi Database

### üî• C√†i ƒë·∫∑t Database Engines cho d·ª± √°n

M·∫∑c ƒë·ªãnh Django set s·∫µn SQLite, tuy nhi√™n Django c≈©ng h·ªó tr·ª£ c√°c Database Engines ph·ªï bi·∫øn:

- PostgreSQL
- MariaDB
- MySQL
- Oracle

Ch√∫ng ta s·∫Ω ch·ªçn `PostgreSQL` ƒë·ªÉ c√†i ƒë·∫∑t cho d·ª± √°n b·∫±ng c√°ch.


Sau khi activate m√¥i tr∆∞·ªùng ·∫£o. C√†i ƒë·∫∑t driver

```bash
pip install psycopg2-binary
```

- **psycopg2-binary** l√†  m·ªôt driver c·∫ßn thi·∫øt ƒë·ªÉ l√†m vi·ªác v·ªõi `PostgreSQL` trong python. Ph√π h·ª£p ƒë·ªÉ ch·∫°y local trong qu√° tr√¨nh development.
- **psycopg2** ƒë∆∞·ª£c ∆∞u ti√™n s·ª≠ d·ª•ng cho m√¥i tr∆∞·ªùng production. N√≥ c·∫ßn th√™m tr√¨nh bi√™n d·ªãch C ƒë·ªÉ ch·∫°y.



### üî• C·∫•u h√¨nh setting.py

S·ª≠a bi·∫øn `DATABASES` file `bikestore/setting.py` 

```python
DATABASES = {
    # 'default': {
    #     'ENGINE': 'django.db.backends.sqlite3',
    #     'NAME': BASE_DIR / 'db.sqlite3',
    # }
    "default": {
        "ENGINE": "django.db.backends.postgresql",
        "NAME": "DjangoPostgres", # T√™n database
        "USER": "postgres", # User database
        "PASSWORD": "123456789",  # Pass database
        "HOST": "localhost",
        "PORT": "5432",
    }
}
```


## üíõ T√¨m hi·ªÉu v·ªÅ Model

Trong Django, Model l√† m·ªôt l·ªõp Python ƒë·∫°i di·ªán cho m·ªôt b·∫£ng trong c∆° s·ªü d·ªØ li·ªáu. M·ªói thu·ªôc t√≠nh c·ªßa model t∆∞∆°ng ·ª©ng v·ªõi m·ªôt tr∆∞·ªùng trong b·∫£ng c∆° s·ªü d·ªØ li·ªáu. M·ªói model th∆∞·ªùng √°nh x·∫° t·ªõi m·ªôt b·∫£ng c∆° s·ªü d·ªØ li·ªáu.

T√†i li·ªáu v·ªÅ Model: 

- https://docs.djangoproject.com/en/5.0/ref/models/
- https://docs.djangoproject.com/en/5.0/topics/db/models/

L∆∞u √Ω quan tr·ªçng

Khi b·∫°n `migrate` th√¨ Django s·∫Ω t·∫°o ra c√°c table ƒë·ªÉ ph·ª•c v·ª• cho vi·ªác x√°c th·ª±c ng∆∞·ªùi d√πng. V√† n·∫øu b·∫°n c√≥ nhu c·∫ßu m·ªü r·ªông th√¨ kh√≥ kh·∫Øn cho vi·ªác l√†m th·∫ø n√†o ƒë·ªÉ m·ªü r·ªông.

Do v·∫≠y ngay t·ª´ l·∫ßn `migrate` ƒë·∫ßu ti√™n trong project Django H√ÉY N√äN l√†m ƒëi·ªÅu n√†y tr∆∞·ªõc.

==> Custom Model X√°c th·ª±c

T∆∞∆°ng ·ª©ng trong m√¥ h√¨nh CSDL ƒë√£ h·ªçc th√¨ `table staffs` l√† table ƒë·ªÉ login v√† ƒëƒÉng nh·∫≠p cho qu·∫£n tr·ªã vi√™n.

```bash
py manage.py startapp staff
python  manage.py startapp staff
```

### üî• ƒê·ªãnh nghƒ©a m·ªôt Model

Custome Model Staff tr∆∞·ªõc, s·ª≠a file `staff/models.py`

```python
from django.db import models
from django.contrib.auth.models import AbstractUser, PermissionsMixin

class Staff(AbstractUser, PermissionsMixin):
    class Meta:
        #ƒê·ªïi t√™n table th√†nh projectName_table_name
        db_table = 'bs_staffs'
        #S·∫Øp x·∫øp m·∫∑c ƒë·ªãnh
        ordering = ['-id', 'first_name']
        
        
    #ƒê·ªÉ hi·ªán th·ªã t√™n ·ªü trong list Dashboard
    def __str__(self):
        return self.first_name + ' ' + self.last_name
    
    avatar = models.ImageField(upload_to='upload/%Y/%m')

```

C·∫•u h√¨nh t·∫≠p tin `settings.py`

```python
#ƒêƒÉng k√Ω th√™m app Staff v√†o
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'home',
    'staff' # ==> Th√™m app staff v√†o
]

#B·∫°n c·∫ßn th√™m bi·∫øn
AUTH_USER_MODEL = 'staff.Staff'
```

C√†i th√™m th∆∞ vi·ªán Pillow v√†o m√¥i tr∆∞·ªùng ·∫£o.

V√¨ `ImageField` t·∫°o ra c∆° ch·∫ø upload v√† c·∫ßn `Pillow` ƒë·ªÉ x·ª≠ l√Ω h√¨nh ·∫£nh.

```bash
py -m pip install Pillow
```

B·∫°n t·∫°o ra Model `Staff` tr∆∞·ªõc nh∆∞ v·∫≠y.

Sau khi `migrate` b·∫°n s·∫Ω th·∫•y Django t·∫°o ra 3 table `bs_staff`, `bs_staffs_groups` v√† `bs_staffs_user_permissions` thay cho c√°c table m·∫∑c ƒë·ªãnh `auth_user`, `auth_groups` v√† `auth_user_user_permissions`

Ch√∫ng ta t√¨m hi·ªÉu v·ªÅ x√°c th·ª±c v√† ph√¢n quy·ªÅn trong b√†i h·ªçc sau.

---

V√≠ d·ª• b·∫°n t·∫°o model Category b·∫±ng c√°ch s·ª≠a file   `category/models.py` th√†nh nh∆∞ sau


```python
from django.db import models

# Create your models here.
class Category(models.Model):
    # Tr∆∞·ªùng category_name
    category_name = models.CharField(max_length=50)
    # Tr∆∞·ªùng description
    description = models.CharField(max_length=500)
```

Khi b·∫°n t·∫°o table th√¨ ƒë·ªìng nghƒ©a n√≥ c≈©ng t·∫°o table category v√† ƒë·ªìng b·ªô v√†o Database.

B·∫°n ph·∫£i ch·∫Øc ch·∫Øn r·∫±ng ƒë√£ th√™m d√≤ng n√†y v√†o `INSTALLED_APPS` trong file settings.py

```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    ##
    'home',
    'staff',
    'category',
]
```

```python
from django.db import models

# Create your models here.
class Category(models.Model):

    # Tr∆∞·ªùng category_name
    category_name = models.CharField(max_length=50)
    # Tr∆∞·ªùng description
    description = models.CharField(max_length=500)
```

T√†i li·ªáu ƒë·ªÉ h·ªçc c√°ch t·∫°o Model v·ªõi c√°c tr∆∞·ªùng v√† ki·ªÉu d·ªØ li·ªáu:

### üî• Field Types

ƒê·ªÉ bi·∫øt c√°ch t·∫°o tr∆∞·ªùng ki·ªÉu chu·ªói, ki·ªÉu boolean, ki·ªÉu date l√† g√¨ ...

Xem ƒë·∫ßy ƒë·ªß: https://docs.djangoproject.com/en/5.0/ref/models/fields/#field-types



V√≠ d·ª•

```python

    # ƒê·ªãnh nghƒ©a kh√≥a ch√≠nh t·ª± tƒÉng. N·∫øu kh√¥ng ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông v·ªõi t√™n id
    product_id = models.AutoField(primary_key=True)
    #product_name nvarchar(255) UNIQUE NOT NULL
    product_name = models.CharField(max_length=255, unique=True)
    # brand C√≥ quan h·ªá v·ªõi Model Brand
    brand = models.ForeignKey(Brand, on_delete=models.SET_NULL)
    # category C√≥ quan h·ªá v·ªõi Model Category
    category = models.ForeignKey(Category, on_delete=models.CASCADE)
    #model_year SMALLINT NOT NULL
    model_year = models.SmallIntegerField()
    #price DECIMAL(18,2) DEFAULT 0
    price = models.DecimalField(max_digits=18, decimal_places=2, default=0)
  

    #description nvarchar(max) NULL
    description = models.TextField(null=True)
    #created_at timestamp 
    created_at = models.DateTimeField(auto_now_add=True)
    #created_at timestamp  
    updated_at = models.DateTimeField(auto_now=True)
    # is_active BOOLEAN NOT NULL DEFAULT True
    is_active = models.BooleanField(default=True)

    #Tr∆∞·ªùng Upload h√¨nh ·∫£nh
    #C·∫ßn c√†i th∆∞ vi·ªán Pillow
    thumbnail = models.ImageField(upload_to='upload/%Y/%m')

    #Email
    email = models.EmailField(max_length=255, unique=True)

    #Tr∆∞·ªùng upload file
    ## file will be saved to MEDIA_ROOT/uploads/2015/01/30
    # C·∫ßn c·∫•u h√¨nh bi·∫øn MEDIA_ROOT
    upload = models.FileField(upload_to="uploads/%Y/%m/%d/")

    #Field ch·ªçn t·ª´ m·ªôt danh s√°ch ƒë·ªãnh s·∫µn
    GENDER_CHOICES = {
        1: 'Female',
        2: 'Male',
        3: 'LGBT'
    }
    gender = models.PositiveSmallIntegerField(default=1, choices=GENDER_CHOICES)
```

Xem th√™m v·ªÅ Model: https://docs.djangoproject.com/en/5.0/ref/models/

---

### üî• Field Options

L√† c√°c t√πy ch·ªçn c·ªßa tr∆∞·ªùng nh∆∞: `Null`, `Not Null`, `Default`, `Unique`, `Primary Key`...

Xem ƒë·∫ßy ƒë·ªß: https://docs.djangoproject.com/en/5.0/ref/models/fields/#field-options


---

## üíõ Migration


Trong Django, `migration` ƒë∆∞·ª£c t·∫°o ra ƒë·ªÉ th·ª±c hi·ªán c√°c thay ƒë·ªïi ƒë·ªëi v·ªõi c·∫•u tr√∫c c∆° s·ªü d·ªØ li·ªáu c·ªßa b·∫°n - n√≥i c√°ch kh√°c, n√≥ l√† c√°ch Django ƒë·ªÅ xu·∫•t ƒë·ªÉ b·∫°n s·ª≠a ƒë·ªïi c∆° s·ªü d·ªØ li·ªáu c·ªßa m√¨nh theo c√°ch an to√†n v√† ki·ªÉm so√°t.

M·ªói khi b·∫°n thay ƒë·ªïi ƒë·ªãnh nghƒ©a c·ªßa `models` trong ·ª©ng d·ª•ng Django c·ªßa b·∫°n, Django s·∫Ω t·∫°o ra m·ªôt `migration` ƒë·ªÉ √°p d·ª•ng nh·ªØng thay ƒë·ªïi n√†y v√†o c∆° s·ªü d·ªØ li·ªáu. M·ªôt `migration` c√≥ th·ªÉ th√™m ho·∫∑c x√≥a b·∫£ng, t·∫°o ho·∫∑c x√≥a ch·ªâ m·ª•c, ho·∫∑c thay ƒë·ªïi lo·∫°i d·ªØ li·ªáu c·ªßa c√°c tr∆∞·ªùng.

ƒê·ªÉ t·∫°o `migration`, b·∫°n s·∫Ω s·ª≠ d·ª•ng l·ªánh `makemigrations`:

```bash
#window
py manage.py makemigrations your_app_label
#MacOS, Ubuntu
python manage.py makemigrations your_app_label
```

ƒê·ªÉ xem l·ªánh SQL thu·∫ßn m√† Django s·∫Ω th·ª±c hi·ªán thay ƒë·ªïi l√™n Database th·∫≠t khi √°p d·ª•ng m·ªôt migration c·ª• th·ªÉ

```bash
#window
py manage.py sqlmigrate your_app_label migration_name
#MacOS, Ubuntu
python manage.py sqlmigrate your_app_label migration_name
```


 ƒêi·ªÅu n√†y r·∫•t h·ªØu √≠ch n·∫øu b·∫°n mu·ªën hi·ªÉu r√µ h∆°n v·ªÅ nh·ªØng thay ƒë·ªïi m√† Django s·∫Ω th·ª±c hi·ªán tr√™n c∆° s·ªü d·ªØ li·ªáu c·ªßa b·∫°n

ƒê·ªÉ √°p d·ª•ng `migration`, b·∫°n s·∫Ω s·ª≠ d·ª•ng l·ªánh `migrate`:

```bash
#window
py manage.py migrate
#MacOS, Ubuntu
python manage.py migrate
```

Nh∆∞ v·∫≠y, `migration` gi√∫p b·∫°n qu·∫£n l√Ω c·∫•u tr√∫c c∆° s·ªü d·ªØ li·ªáu c·ªßa m√¨nh m·ªôt c√°ch linh ho·∫°t v√† an to√†n. N·∫øu sai s√≥t b·∫°n c√≥ th·ªÉ kh√¥i ph·ª•c (rollback) l·∫°i tr·∫°ng th√°i tr∆∞·ªõc khi th·ª±c hi·ªán.



ƒê·ªÉ h·ªßy m·ªôt migration trong Django, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng l·ªánh `migrate` k√®m theo t√™n c·ªßa ·ª©ng d·ª•ng v√† t√™n c·ªßa migration m√† b·∫°n mu·ªën quay l·∫°i tr∆∞·ªõc ƒë√≥. C√∫ ph√°p c·ªßa l·ªánh nh∆∞ sau:

```bash
#window
py manage.py migrate your_app_label migration_name
#MacOS, Ubuntu
python manage.py migrate your_app_label migration_name
```


N·∫øu b·∫°n mu·ªën h·ªßy t·∫•t c·∫£ c√°c migration c·ªßa m·ªôt ·ª©ng d·ª•ng, b·∫°n c√≥ th·ªÉ ch·ªâ cung c·∫•p t√™n ·ª©ng d·ª•ng:

```bash
#window
py manage.py migrate your_app_label zero
#MacOS, Ubuntu
python manage.py migrate your_app_label zero
```

L∆∞u √Ω r·∫±ng, vi·ªác h·ªßy migration c√≥ th·ªÉ g√¢y ra m·∫•t d·ªØ li·ªáu n·∫øu migration b·∫°n h·ªßy ƒë√£ thay ƒë·ªïi c·∫•u tr√∫c c∆° s·ªü d·ªØ li·ªáu. H√£y c·∫©n th·∫≠n khi s·ª≠ d·ª•ng l·ªánh n√†y.


T√†i li·ªáu:

- makemigrations: https://docs.djangoproject.com/en/5.0/ref/django-admin/#django-admin-makemigrations
- migrate: https://docs.djangoproject.com/en/5.0/ref/django-admin/#migrate


Ti·∫øp n·ªëi v√≠ d·ª• tr√™n b·∫°n nh·∫≠p l·ªánh

```bash
#window
py manage.py makemigrations category
#MacOS, Ubuntu
python manage.py makemigrations category
```

Ki·ªÉu nh∆∞ b·∫°n ƒë·∫∑t t√™n cho nh·ªØng thay ƒë·ªïi l√™n model.

H·ªá th·ªëng s·∫Ω sinh ra m·ªôt file `category/migrations/0001_initial.py`. ƒê·ªÉ l∆∞u l·∫°i nh·ªØng thay ƒë·ªïi n√†y.

ƒê·ªÉ √°p d·ª•ng nh·ªØng thay ƒë·ªïi ƒë√≥ b·∫°n ch·∫°y l·ªánh

```bash
#window
py manage.py migrate
#MacOS, Ubuntu
python manage.py migrate
```

Django s·∫Ω t·∫°o table `category` v√†o trong Datatabase th·∫≠t m√† ƒë√£ c·∫•u h√¨nh trong `settings.py`


## üíõ Truy v·∫•n Model tr√™n Python Shell

Django cung c·∫•p cho ch√∫ng ta m·ªôt c√¥ng c·ª• r·∫•t m·∫°nh m·∫Ω l√† `shell`, th·ª±c thi c√°c ph∆∞∆°ng th·ª©c c·ªßa L·ªõp Model tr√™n m√¥i tr∆∞·ªùng nhanh ch√≥ng.

Gi√∫p b·∫°n Debug, xem tr∆∞·ªõc, ho·∫∑c t√°c ƒë·ªông l√™n Database th√¥ng qua d√≤ng l·ªánh.

```bash
#windown
py manage.py shell
#MacOS, Ubuntu
python manage.py shell
```

Sau khi ch·∫°y xong b·∫°n s·∫Ω th·∫•y tr∆∞·ªõc con tr·ªè xu·∫•t hi·ªán d·∫•u `>>>`, ƒë√¢y ch√≠nh l√† m√¥i tr∆∞·ªùng d√≤ng l·ªánh c·ªßa `shell`.

Khi b·∫°n ·ªü `Shell`, th√¨ c√πng ng·ªØ c·∫£nh c√°c b·∫°n ƒëang ƒë·ª©ng trong app.

C√∫ ph√°p l·ªánh tr√™n `shell` ho√†n to√†n gi·ªëng khi b·∫°n thao t√°c tr√™n app v·ªõi t·∫≠p tin `.py`

V√≠ d·ª• b·∫°n mu·ªën thao t√°c v·ªõi Model `Category` ƒë·ªÉ truy v·∫•n d·ªØ li·ªáu.

B∆∞·ªõc 1: B·∫°n ph·∫£i nh√∫ng Model c·∫ßn thao t√°c v√†o shell

```bash
>>> from category.models import Category #nh·∫•n Enter
```
B∆∞·ªõc 2: Sau ƒë√≥ b·∫°n c√≥ th·ªÉ thao t√°c v·ªõi m·ªçi th·ª© v·ªõi `Category` v√† Django ƒë√£ thi·∫øt l·∫≠p cho n√≥.

V√≠ d·ª• ƒë·ªÉ xem danh s√°ch danh m·ª•c ƒë√£ t·∫°o

```bash
>>> Category.objects.all()
#K·∫øt qu·∫£
<QuerySet []>
```

### üî• QuerySet l√† g√¨ ?

Trong Django, QuerySet l√† m·ªôt t·∫≠p h·ª£p c√°c ƒë·ªëi t∆∞·ª£ng t·ª´ c∆° s·ªü d·ªØ li·ªáu. QuerySet ƒë∆∞·ª£c x√¢y d·ª±ng nh∆∞ m·ªôt danh s√°ch c√°c ƒë·ªëi t∆∞·ª£ngQuerySet gi√∫p b·∫°n d·ªÖ d√†ng l·∫•y d·ªØ li·ªáu b·∫°n th·ª±c s·ª± c·∫ßn, b·∫±ng c√°ch cho ph√©p b·∫°n l·ªçc v√† s·∫Øp x·∫øp d·ªØ li·ªáu ·ªü m·ªôt giai ƒëo·∫°n s·ªõm.

QuerySet l√† m·ªôt `Lazy`, v√¨ n√≥ kh√¥ng th·ª±c hi·ªán truy v·∫•n c∆° s·ªü d·ªØ li·ªáu ngay l·∫≠p t·ª©c khi b·∫°n t·∫°o ra n√≥.

Thay v√†o ƒë√≥, QuerySet ch·ªâ th·ª±c hi·ªán truy v·∫•n khi b·∫°n y√™u c·∫ßu ƒë√°nh gi√° n√≥, v√≠ d·ª• nh∆∞ khi b·∫°n l·∫∑p qua QuerySet ho·∫∑c khi b·∫°n g·ªçi m·ªôt ph∆∞∆°ng th·ª©c c·ªßa n√≥ nh∆∞ .count(), .filter()...

### üî• Insert d·ªØ li·ªáu v√†o Model

V√≠ d·ª• ƒë·ªÉ ch√®n th√™m c√°c record m·ªõi v·ªõi table Category

```bash
>>> category = Category(category_name="Mouse", description="Mouse description") #Enter
>>>category.save() #Enter
```

B·∫°n c√≥ th·ªÉ ki·ªÉm tra l·∫°i d·ªØ li·ªáu b·∫±ng c√°ch

```bash
>>> Category.objects.all().values() #Enter
# T∆∞∆°ng ƒë∆∞∆°ng c√¢u l·ªánh
# SELECT * FROM category
```



### üî• Update d·ªØ li·ªáu cho Model

V√≠ d·ª• c·∫≠p nh·∫≠t description cho record c√≥ id = 4

```bash
>>> c = Category.objects.all()[1] #Enter
```

`c` b√¢y gi·ªù n√≥ ƒë·∫°i di·ªán cho d√≤ng d·ªØ li·ªáu `record` c√≥ id = 4. V√† n√≥ l√† m·ªôt object do v·∫≠y b·∫°n c√≥ th·ªÉ thay ƒë·ªïi gi√° tr·ªã cho c√°c ph·∫ßn t·ª≠ c·ªßa object.

```bash
>>> c.description
#K·∫øt qu·∫£
'Mouse description'
```

B√¢y gi·ªù b·∫°n c√≥ th·ªÉ thay ƒë·ªïi gi√° tr·ªã

```bash
>>> c.description='Mouse description updated' #Enter
>>> c.save() #Enter
```

B·∫°n c√≥ th·ªÉ ki·ªÉm tra l·∫°i d·ªØ li·ªáu b·∫±ng c√°ch

```bash
>>> Category.objects.all().values() #Enter
```

### üî• X√≥a d·ªØ li·ªáu v√†o Model

T∆∞∆°ng t·ª± nh∆∞ v·∫≠y b·∫°n ph·∫£i truy c·∫≠p ƒë·∫øn d√≤ng d·ªØ li·ªáu c·∫ßn x√≥a sau ƒë√≥ m·ªõi th·ª±c hi·ªán x√≥a.

```bash
>>> c = Category.objects.all()[1] #Enter
>>> c.delete() #Enter
```

## üíõ T√≠nh k·ªÅ th·ª´a Model

Django t·ªï ch·ª©c c√°c Model d∆∞·ªõi d·∫°ng Class OOP do v·∫≠y n√≥ s·∫Ω c√≥ ƒë·∫∑c t√≠nh k·∫ø th·ª´a c·ªßa h∆∞·ªõng ƒë·ªëi t∆∞·ª£ng.

V√≠ d·ª• b·∫°n c√≥ Model `customers` v√† `staff` nh∆∞ sau:

```python
from django.db import models

class Customer(models.Model):
   #Meta c·∫•u h√¨nh t√πy ch·ªçn kh√°c cho Model
    class Meta:
        #Custom l·∫°i t√™n table th√†nh customers
        db_table = 'customers'
    
    #Khai b√°o c√°c tr∆∞·ªùng
    first_name = models.CharField(max_length=50,null=False,blank=False)
    last_name = models.CharField(max_length=50,null=False,blank=False)
    phone = model.CharField(max_length=20,unique=True)
    email = model.CharField(max_length=150,unique=True)
    street = model.CharField(max_length=255)
    city = model.CharField(max_length=50)
    state = model.CharField(max_length=50)
    zip_code = model.CharField(max_length=5, null=True)

class Staff(models.Model):
   #Meta c·∫•u h√¨nh t√πy ch·ªçn kh√°c cho Model
    class Meta:
        #Custom l·∫°i t√™n table th√†nh staffs
        db_table = 'staffs'
    
    #Khai b√°o c√°c tr∆∞·ªùng
    first_name = models.CharField(max_length=50,null=False,blank=False)
    last_name = models.CharField(max_length=50,null=False,blank=False)
    phone = model.CharField(max_length=20,unique=True)
    email = model.CharField(max_length=150,unique=True)
    active = model.BooleanField(default=1)

```

D·ªÖ th·∫•y r·∫±ng 2 Model tr√™n ƒë·ªÅu c√≥ c√°c tr∆∞·ªùng `first_name`, `last_name`, `phone`, `email`.

Do v·∫≠y ch√∫ng ta c√≥ th·ªÉ t√°ch ra th√†nh m·ªôt Model kh√°c r·ªìi sau ƒë√≥ k·∫ø th·ª´a ƒë·ªÉ t·ªëi ∆∞u ƒë∆∞·ª£c code.


```python
from django.db import models

# T·∫°o l·ªõp Model Abstract chung


class PersonAbstract(models.Model):
    class Meta:
        #Ch·ªâ ƒë·ªãnh n√≥ l√† model abstract
        # N·∫øu kh√¥ng n√≥ s·∫Ω sinh ra table m·ªõi trong Database
        abstract = True

    #Khai b√°o c√°c tr∆∞·ªùng chung
    first_name = models.CharField(max_length=50,null=False,blank=False)
    last_name = models.CharField(max_length=50,null=False,blank=False)
    phone = model.CharField(max_length=20,unique=True)
    email = model.CharField(max_length=150,unique=True)

# K·∫ø th·ª´a l·∫°i PersonAbstract
class Customer(PersonAbstract):  
    class Meta:
        #Custom l·∫°i t√™n table th√†nh customers
        db_table = 'customers'
    
    #Gi·ªØ l·∫°i c√°c tr∆∞·ªùng ri√™ng 
    street = model.CharField(max_length=255)
    city = model.CharField(max_length=50)
    state = model.CharField(max_length=50)
    zip_code = model.CharField(max_length=5, null=True)

# K·∫ø th·ª´a l·∫°i PersonAbstract
class Staff(PersonAbstract):
   #Meta c·∫•u h√¨nh t√πy ch·ªçn kh√°c cho Model
    class Meta:
        #Custom l·∫°i t√™n table th√†nh staffs
        db_table = 'staffs'
    
    #Gi·ªØ l·∫°i c√°c tr∆∞·ªùng ri√™ng 
    active = model.BooleanField(default=1)

```

## üíõ Meta Model Options

Xem chi ti·∫øt: https://docs.djangoproject.com/en/5.0/ref/models/options/

D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë t√πy ch·ªçn Meta b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng trong m√¥ h√¨nh Django:

- `abstract`: N·∫øu `abstract = True`, m√¥ h√¨nh n√†y s·∫Ω l√† m·ªôt l·ªõp c∆° s·ªü tr·ª´u t∆∞·ª£ng.
- `app_label`: N·∫øu m·ªôt m√¥ h√¨nh ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b√™n ngo√†i m·ªôt ·ª©ng d·ª•ng trong `INSTALLED_APPS`, n√≥ ph·∫£i khai b√°o ·ª©ng d·ª•ng m√† n√≥ thu·ªôc v·ªÅ: `app_label = "myapp"`.
- `base_manager_name`: T√™n thu·ªôc t√≠nh c·ªßa tr√¨nh qu·∫£n l√Ω, v√≠ d·ª•, 'objects', ƒë·ªÉ s·ª≠ d·ª•ng cho `base_manager` c·ªßa m√¥ h√¨nh.
- `db_table`: T√™n c·ªßa b·∫£ng c∆° s·ªü d·ªØ li·ªáu ƒë·ªÉ s·ª≠ d·ª•ng cho m√¥ h√¨nh: `db_table = "music_album"`.
- `db_table_comment`: B√¨nh lu·∫≠n v·ªÅ b·∫£ng c∆° s·ªü d·ªØ li·ªáu ƒë·ªÉ s·ª≠ d·ª•ng cho m√¥ h√¨nh n√†y. N√≥ h·ªØu √≠ch ƒë·ªÉ t√†i li·ªáu h√≥a c√°c b·∫£ng c∆° s·ªü d·ªØ li·ªáu cho nh·ªØng ng∆∞·ªùi c√≥ quy·ªÅn truy c·∫≠p tr·ª±c ti·∫øp v√†o c∆° s·ªü d·ªØ li·ªáu m√† c√≥ th·ªÉ kh√¥ng xem m√£ Django c·ªßa b·∫°n.
- `db_tablespace`: T√™n c·ªßa kh√¥ng gian b·∫£ng c∆° s·ªü d·ªØ li·ªáu ƒë·ªÉ s·ª≠ d·ª•ng cho m√¥ h√¨nh n√†y.


- `ordering`: T√πy ch·ªçn n√†y cho ph√©p b·∫°n ch·ªâ ƒë·ªãnh th·ª© t·ª± m·∫∑c ƒë·ªãnh c·ªßa c√°c b·∫£n ghi ƒë∆∞·ª£c tr·∫£ v·ªÅ khi b·∫°n truy v·∫•n m√¥ h√¨nh. B·∫°n c√≥ th·ªÉ s·∫Øp x·∫øp theo nhi·ªÅu tr∆∞·ªùng b·∫±ng c√°ch s·ª≠ d·ª•ng m·ªôt tuple ho·∫∑c list. V√≠ d·ª•: `ordering = ['lastname', '-id']` s·∫Ω s·∫Øp x·∫øp k·∫øt qu·∫£ theo `lastname` tƒÉng d·∫ßn v√† `id` gi·∫£m d·∫ßn.

- `indexes`: T√πy ch·ªçn n√†y cho ph√©p b·∫°n t·∫°o c√°c ch·ªâ m·ª•c t√πy ch·ªânh cho m·ªôt m√¥ h√¨nh. M·ªói ch·ªâ m·ª•c trong danh s√°ch ph·∫£i l√† m·ªôt th·ªÉ hi·ªán c·ªßa `django.db.models.Index`. V√≠ d·ª•: `indexes = [models.Index(fields=['last_name', 'first_name', '-date_of_birth'])]` s·∫Ω t·∫°o m·ªôt ch·ªâ m·ª•c tr√™n c√°c tr∆∞·ªùng `last_name`, `first_name` v√† `date_of_birth` (theo th·ª© t·ª± gi·∫£m d·∫ßn).

- `unique_together`: T√πy ch·ªçn n√†y cho ph√©p b·∫°n ƒë·∫£m b·∫£o r·∫±ng m·ªôt c·∫∑p gi√° tr·ªã kh√¥ng bao gi·ªù ƒë∆∞·ª£c l·∫∑p l·∫°i. N√≥ nh·∫≠n m·ªôt danh s√°ch c√°c tuple, trong ƒë√≥ m·ªói tuple ch·ª©a c√°c t√™n tr∆∞·ªùng c·∫ßn duy nh·∫•t. V√≠ d·ª•: `unique_together = (("driver", "restaurant"),)` s·∫Ω ƒë·∫£m b·∫£o r·∫±ng m·ªói c·∫∑p gi√° tr·ªã `driver` v√† `restaurant` l√† duy nh·∫•t trong b·∫£ng.

- `index_together`: T∆∞∆°ng t·ª± nh∆∞ `unique_together`, nh∆∞ng thay v√¨ ƒë·∫£m b·∫£o t√≠nh duy nh·∫•t, n√≥ t·∫°o c√°c ch·ªâ m·ª•c ƒë·ªÉ t·ªëi ∆∞u h√≥a vi·ªác truy v·∫•n. V√≠ d·ª•: `index_together = (("user", "time"),)` s·∫Ω t·∫°o m·ªôt ch·ªâ m·ª•c tr√™n c·∫∑p tr∆∞·ªùng `user` v√† `time`.

- `constraints`: T√πy ch·ªçn n√†y cho ph√©p b·∫°n t·∫°o c√°c r√†ng bu·ªôc t√πy ch·ªânh cho m√¥ h√¨nh. M·ªói r√†ng bu·ªôc trong danh s√°ch ph·∫£i l√† m·ªôt th·ªÉ hi·ªán c·ªßa `django.db.models.CheckConstraint` ho·∫∑c `django.db.models.UniqueConstraint`. V√≠ d·ª•: `constraints = [models.CheckConstraint(check=models.Q(age__gte=18), name="age_gte_18")]` s·∫Ω t·∫°o m·ªôt r√†ng bu·ªôc ki·ªÉm tra ƒë·ªÉ ƒë·∫£m b·∫£o r·∫±ng `age` lu√¥n l·ªõn h∆°n ho·∫∑c b·∫±ng 18.


V√≠ d·ª•:

```python
from django.db import models

# Create your models here.
class Category(models.Model):
    class Meta:
        #ƒê·∫∑t t√™n table
        db_table = 'bs_categories'
        #C·∫•u h√¨nh s·∫Øp x·∫øp m·∫∑c ƒë·ªãnh
        ordering = ['category_name']

    # Tr∆∞·ªùng category_name
    category_name = models.CharField(max_length=50)
    # Tr∆∞·ªùng description
    description = models.CharField(max_length=500)
```

```python
from django.db import models

class Product(models.Model):
    class Meta:
        #ƒê·∫∑t t√™n table
        db_table = 'products'
        #C·∫•u h√¨nh s·∫Øp x·∫øp m·∫∑c ƒë·ªãnh
        ordering = ['-id'] #d·∫•u - tr∆∞·ªõc t√™n tr∆∞·ªùng l√† DESC
        #ƒê√°nh ch·ªâ m·ª•c index
        indexes = [models.Index(fields=['product_name', 'price'])]
        #Ch·ªëng tr√πng l·∫∑p
        unique_together = (("product_name", "category_id"),)
        # Danh s√°ch c√°c constraints
        constraints = [
            models.CheckConstraint(check=models.Q(price__gte=0), name='ck_products_price'),
            models.CheckConstraint(check=models.Q(discount__gte=0, discount__lte=70), name='ck_products_discount'),
        ]
```

L∆∞u √Ω r·∫±ng t√πy ch·ªçn Meta kh√¥ng ph·∫£i l√† b·∫Øt bu·ªôc, v√† b·∫°n ch·ªâ n√™n s·ª≠ d·ª•ng ch√∫ng khi b·∫°n mu·ªën thay ƒë·ªïi c√°c gi√° tr·ªã m·∫∑c ƒë·ªãnh.

Xem th√™m v·ªÅ Contraints: https://docs.djangoproject.com/en/5.0/ref/models/constraints/

Xem th√™m v·ªÅ Index: https://docs.djangoproject.com/en/5.0/ref/models/indexes/


## üíõ M·ªëi quan h·ªá gi·ªØa c√°c Models


Chi ti·∫øt xem: https://docs.djangoproject.com/en/5.0/ref/models/fields/#module-django.db.models.fields.related

B·∫°n c·∫ßn n·∫Øm c√°c c√∫ ph√°p ƒë·ªÉ khai b√°o m·ªëi quan h·ªá gi·ªØa c√°c Model trong Django: `many-to-one`, `many-to-many` v√† `one-to-one`

### üî• Many-to-one

ƒê·ªÉ ƒë·ªãnh nghƒ©a quan h·ªá Many-to-one, b·∫°n s·ª≠ d·ª•ng `django.db.models.ForeignKey` khi b√°o tr∆∞·ªùng ƒë√≥ trong Model

L·ªõp n√†y c·∫ßn ƒë·ªëi s·ªë:

- model: Model c·∫ßn tham chi·∫øu t·ªõi
- on_delete: H√†nh ƒë·ªông th·ª±c hi·ªán cho d√≤ng d·ªØ li·ªáu c·ªßa table CON khi CHA b·ªã X√ìA

C√°c tr∆∞·ªùng `ForeignKey` s·∫Ω ƒë∆∞·ª£c ƒë√°nh index t·ª± ƒë·ªông (db_index=True)
Khi th·ª±c hi·ªán  `mirgate` ƒë·ªÉ t·∫°o CSDL th√¨ Django t·ª± ƒë·ªông th√™m ƒëu√¥i _id v√†o t√™n tr∆∞·ªùng ForeignKey. V√≠ d·ª•: category, d∆∞·ªõi CDSL s·∫Ω l√† category_id.


```python

from django.db import models


class Category(models.Model):
    # ...
    pass

class Product(models.Model):
    # ...
    # brand C√≥ quan h·ªá v·ªõi Model Brand
    brand = models.ForeignKey(Brand, on_delete=models.SET_NULL,related_name='products_brand')
    # category C√≥ quan h·ªá v·ªõi Model Category
    category = models.ForeignKey(Category, on_delete=models.SET_NULL, related_name='products_category')
```

L∆∞u √Ω: M·∫∑c d√π b·∫°n s·ª≠ d·ª•ng t√™n l√† `category` nh∆∞ng khi t·∫°o database django s·∫Ω n·ªëi th√†nh `category_id`

Trong ƒë√≥ `on_delete` s·∫Ω c√≥ c√°c t√πy ch·ªçn:

- models.CASCADE
- models.SET_NULL
- models.PROTECT
- models.RESTRICT
- models.SET_DEFAULT
- models.SET
- models.DO_NOTHING

#### related_name

Trong ƒë√≥ `related_name` l√† m·ªôt t√πy ch·ªçn b·∫°n c√≥ th·ªÉ ƒë·∫∑t cho m·ªôt tr∆∞·ªùng ForeignKey. N√≥ cung c·∫•p m·ªôt c√°ch ƒë·ªÉ truy c·∫≠p t·ª´ m√¥ h√¨nh li√™n k·∫øt (ƒë∆∞·ª£c tham chi·∫øu b·ªüi ForeignKey) tr·ªü l·∫°i m√¥ h√¨nh ban ƒë·∫ßu.

N·∫øu b·∫°n kh√¥ng ch·ªâ ƒë·ªãnh `related_name`, Django s·∫Ω t·ª± ƒë·ªông t·∫°o ra m·ªôt t√™n b·∫±ng c√°ch s·ª≠ d·ª•ng t√™n c·ªßa m√¥ h√¨nh c·ªßa b·∫°n v·ªõi h·∫≠u t·ªë `_set`

V√≠ d·ª•: Model `Products` c√≥ kh√≥a ngo·∫°i ƒë·∫øn `Category`, b·∫°n c√≥ th·ªÉ l·∫•y t·∫•t c·∫£ s·∫£n ph·∫©m c·ªßa m·ªôt danh m·ª•c b·∫±ng c√°ch: `category.product_set.all()`

Nh∆∞ng n·∫øu b·∫°n ch·ªâ ƒë·ªãnh `related_name`. V√≠ d·ª•: `related_name='products_category'`, b·∫°n c√≥ th·ªÉ l·∫•y v·ªõi `category.products_category.all()`

#### related_query_name

Trong Django, `related_query_name` l√† m·ªôt t√πy ch·ªçn b·∫°n c√≥ th·ªÉ ƒë·∫∑t cho m·ªôt tr∆∞·ªùng `ForeignKey`. N√≥ cung c·∫•p m·ªôt t√™n ƒë·ªÉ s·ª≠ d·ª•ng khi th·ª±c hi·ªán c√°c truy v·∫•n li√™n quan t·ª´ m√¥ h√¨nh li√™n k·∫øt (ƒë∆∞·ª£c tham chi·∫øu b·ªüi `ForeignKey`) tr·ªü l·∫°i m√¥ h√¨nh ban ƒë·∫ßu.

N·∫øu b·∫°n kh√¥ng ch·ªâ ƒë·ªãnh `related_query_name`, Django s·∫Ω t·ª± ƒë·ªông t·∫°o ra m·ªôt t√™n b·∫±ng c√°ch s·ª≠ d·ª•ng t√™n c·ªßa m√¥ h√¨nh c·ªßa b·∫°n v·ªõi h·∫≠u t·ªë `_set`.

V√≠ d·ª•, n·∫øu b·∫°n c√≥ m·ªôt m√¥ h√¨nh `User` v√† m·ªôt m√¥ h√¨nh `Article` v·ªõi m·ªôt tr∆∞·ªùng `ForeignKey` ƒë·∫øn `User`, b·∫°n c√≥ th·ªÉ truy c·∫≠p t·∫•t c·∫£ c√°c b√†i vi·∫øt c·ªßa m·ªôt ng∆∞·ªùi d√πng b·∫±ng c√°ch s·ª≠ d·ª•ng `user.article_set.all()`.

N·∫øu b·∫°n ch·ªâ ƒë·ªãnh `related_query_name`, v√≠ d·ª• `related_query_name='articles'`, th√¨ b·∫°n c√≥ th·ªÉ truy c·∫≠p t·∫•t c·∫£ c√°c b√†i vi·∫øt c·ªßa m·ªôt ng∆∞·ªùi d√πng b·∫±ng c√°ch s·ª≠ d·ª•ng `User.objects.filter(articles__published_date__year=2023)` ƒë·ªÉ l·∫•y t·∫•t c·∫£ ng∆∞·ªùi d√πng ƒë√£ xu·∫•t b·∫£n m·ªôt b√†i vi·∫øt trong nƒÉm 2023.


### üî• Many-to-Many


Trong Django, m·ªëi quan h·ªá nhi·ªÅu-nhi·ªÅu (Many-to-many) gi·ªØa hai m√¥ h√¨nh ƒë∆∞·ª£c t·∫°o ra b·∫±ng c√°ch s·ª≠ d·ª•ng tr∆∞·ªùng `ManyToManyField`

V√≠ d·ª•: Ch√∫ng ta c√≥ `Products` c√≥ quan h·ªá Many-to-Many v·ªõi `Orders`. 1 S·∫£n ph·∫©m c√≥ th·ªÉ thu·ªôc nhi·ªÅu ƒë∆°n h√†ng, v√† 1 ƒë∆°n h√†ng c√≥ th·ªÉ c√≥ nhi·ªÅu s·∫£n ph·∫©m.

```python
from django.db import models

class Product(models.Model):
    product_name = models.CharField(max_length=100)
    price = models.DecimalField(max_digits=5, decimal_places=2)

class Order(models.Model):
    #...
    order_date = models.DateField(),
    products = models.ManyToManyField(Product)
```

Khi b·∫°n set nh∆∞ v·∫≠y th√¨ Django t·ª± ƒë·ªông t·∫°o th√™m m·ªôt table `product_order` l√†m b·∫£ng trung gian  v·ªõi 2 kh√≥a ngo·∫°i l√† product_id, order_id ƒë·ªÉ th·ªÉ hi·ªán quan h·ªá `many-to-many`

Tuy nhi√™n, trong m√¥ h√¨nh b√°n h√†ng. Table `product_order` c·∫ßn th√™m c·ªôt `quantity`, `price`... ƒë·ªÉ m·ªü r·ªông th√¥ng tin. Do v·∫≠y Django cung c·∫•p cho b·∫°n m·ªôt c√°ch th·ª©c ƒë·ªÉ m·ªü r·ªông b·∫±ng c√°ch s·ª≠ d·ª•ng t√πy ch·ªçn `through`


```python
from django.db import models

class Product(models.Model):
    product_name = models.CharField(max_length=100)
    price = models.DecimalField(max_digits=5, decimal_places=2)

class Order(models.Model):
    #...
    order_date = models.DateField()
    products = models.ManyToManyField(Product, through='OrderItem')

#Custom Model quan h·ªá Many-to-Many
class OrderItem(models.Model):
    product = models.ForeignKey(Product, on_delete=models.CASCADE)
    order = models.ForeignKey(Order, on_delete=models.CASCADE)
    # C√°c tr∆∞·ªùng m·ªü r·ªông
    quantity = models.PositiveIntegerField()
    price = models.DecimalField(max_digits=5, decimal_places=2)
    discount = models.DecimalField(max_digits=5, decimal_places=2)
```

L∆∞u √Ω r·∫±ng khi b·∫°n s·ª≠ d·ª•ng thu·ªôc t√≠nh `through`, Django s·∫Ω kh√¥ng t·ª± ƒë·ªông t·∫°o c√°c tr∆∞·ªùng trong b·∫£ng trung gian khi b·∫°n th√™m c√°c m·ªëi quan h·ªá. Thay v√†o ƒë√≥, b·∫°n s·∫Ω c·∫ßn ph·∫£i t·∫°o c√°c tr∆∞·ªùng trong `OrderItem` m·ªôt c√°ch th·ªß c√¥ng

---

#### Truy v·∫•n Many-to-Many

B·∫°n c√≥ th·ªÉ truy v·∫•n c√°c s·∫£n ph·∫©m trong m·ªôt ƒë∆°n h√†ng ho·∫∑c c√°c ƒë∆°n h√†ng m√† m·ªôt s·∫£n ph·∫©m l√† m·ªôt ph·∫ßn c·ªßa nh∆∞ sau:

```python
# L·∫•y t·∫•t c·∫£ c√°c s·∫£n ph·∫©m trong m·ªôt ƒë∆°n h√†ng
order = Order.objects.get(id=1)
products_in_order = order.products.all()

# L·∫•y t·∫•t c·∫£ c√°c ƒë∆°n h√†ng m√† m·ªôt s·∫£n ph·∫©m l√† m·ªôt ph·∫ßn c·ªßa
product = Product.objects.get(id=1)
orders_with_product = product.order_set.all()
```

M·ªôt object ƒë∆∞·ª£c Django t·ª± ƒë·ªông t·∫°o ra v·ªõi c√∫ ph√°p: `model_set` --> order_set


Nh∆∞ng n·∫øu b·∫°n ƒë√£ custom v·ªõi `through` th√¨ truy v·∫•n thay ƒë·ªïi th√†nh

```python
# L·∫•y t·∫•t c·∫£ c√°c s·∫£n ph·∫©m trong m·ªôt ƒë∆°n h√†ng c√πng v·ªõi s·ªë l∆∞·ª£ng
order = Order.objects.get(id=1)
product_orders = order.orderitem_set.all()
for product_order in product_orders:
    print(product_order.product.name, product_order.quantity)

# L·∫•y t·∫•t c·∫£ c√°c ƒë∆°n h√†ng m√† m·ªôt s·∫£n ph·∫©m l√† m·ªôt ph·∫ßn c·ªßa c√πng v·ªõi s·ªë l∆∞·ª£ng
product = Product.objects.get(id=1)
product_orders = product.orderitem_set.all()
for product_order in product_orders:
    print(product_order.order.id, product_order.quantity)
```

Django c≈©ng t·∫°o t·ª± ƒë·ªông v·ªõi c√∫ ph√°p: `throughvalue_set` --> orderitem_set

---

### üî• One-to-One

Trong Django, m·ªëi quan h·ªá M·ªôt-M·ªôt (One-to-One) gi·ªØa hai m√¥ h√¨nh ƒë∆∞·ª£c t·∫°o ra b·∫±ng c√°ch s·ª≠ d·ª•ng tr∆∞·ªùng `OneToOneField`.

V√≠ d·ª•, gi·∫£ s·ª≠ b·∫°n c√≥ hai m√¥ h√¨nh l√† `User` v√† `UserProfile`, trong ƒë√≥ m·ªôt ƒë·ªãa ƒëi·ªÉm c√≥ th·ªÉ l√† m·ªôt nh√† h√†ng. B·∫°n c√≥ th·ªÉ t·∫°o m·ªëi quan h·ªá M·ªôt-M·ªôt gi·ªØa ch√∫ng nh∆∞ sau:

```python
from django.db import models

class User(models.Model):
    name = models.CharField(max_length=100)

class UserProfile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE, primary_key=True)
    bio = models.TextField()
```

Trong v√≠ d·ª• n√†y, tr∆∞·ªùng `user` trong m√¥ h√¨nh `UserProfile` l√† m·ªôt `OneToOneField` li√™n k·∫øt ƒë·∫øn m√¥ h√¨nh `User`.

Khi b·∫°n t·∫°o m·ªôt m·ªëi quan h·ªá M·ªôt-M·ªôt, Django s·∫Ω t·ª± ƒë·ªông t·∫°o m·ªôt r√†ng bu·ªôc duy nh·∫•t tr√™n tr∆∞·ªùng ƒë·ªÉ ƒë·∫£m b·∫£o r·∫±ng m·ªói ƒë·ªëi t∆∞·ª£ng `User` ch·ªâ c√≥ th·ªÉ li√™n k·∫øt v·ªõi m·ªôt ƒë·ªëi t∆∞·ª£ng `UserProfile` duy nh·∫•t.

B·∫°n c√≥ th·ªÉ truy c·∫≠p ƒë·ªëi t∆∞·ª£ng `User` t·ª´ m·ªôt ƒë·ªëi t∆∞·ª£ng `UserProfile` ho·∫∑c ng∆∞·ª£c l·∫°i b·∫±ng c√°ch s·ª≠ d·ª•ng t√™n c·ªßa m√¥ h√¨nh. V√≠ d·ª•:

```python
# Truy c·∫≠p ƒë·ªëi t∆∞·ª£ng User t·ª´ m·ªôt ƒë·ªëi t∆∞·ª£ng UserProfile
profile = UserProfile.objects.get(id=1)
user = profile.user

# Truy c·∫≠p ƒë·ªëi t∆∞·ª£ng UserProfile t·ª´ m·ªôt ƒë·ªëi t∆∞·ª£ng User
user = User.objects.get(id=1)
profile = user.userprofile

```

L∆∞u √Ω r·∫±ng khi b·∫°n truy c·∫≠p m·ªôt ƒë·ªëi t∆∞·ª£ng t·ª´ m·ªôt m·ªëi quan h·ªá M·ªôt-M·ªôt, Django s·∫Ω t·∫°o m·ªôt truy v·∫•n database. N·∫øu kh√¥ng c√≥ ƒë·ªëi t∆∞·ª£ng n√†o ph√π h·ª£p, Django s·∫Ω n√©m ra m·ªôt ngo·∫°i l·ªá `DoesNotExist`.

C√°c t√πy ch·ªçn kh√°c cho `OneToOneField` bao g·ªìm:

- `on_delete`: ƒê√¢y l√† m·ªôt t√πy ch·ªçn b·∫Øt bu·ªôc m√† b·∫°n ph·∫£i ch·ªâ ƒë·ªãnh. N√≥ x√°c ƒë·ªãnh h√†nh ƒë·ªông s·∫Ω x·∫£y ra khi ƒë·ªëi t∆∞·ª£ng m√† tr∆∞·ªùng `OneToOneField` li√™n k·∫øt ƒë·∫øn b·ªã x√≥a.
- `primary_key`: N·∫øu b·∫°n ƒë·∫∑t t√πy ch·ªçn n√†y th√†nh `True`, th√¨ 2 table s·∫Ω chung t√™n tr∆∞·ªùng kh√≥a ch√≠nh.
- `related_name`: T√πy ch·ªçn n√†y cho ph√©p b·∫°n ch·ªâ ƒë·ªãnh m·ªôt t√™n kh√°c ƒë·ªÉ truy c·∫≠p m·ªëi quan h·ªá t·ª´ m√¥ h√¨nh li√™n k·∫øt.
- `related_query_name`: T√πy ch·ªçn n√†y cho ph√©p b·∫°n ƒë·∫∑t m·ªôt t√™n kh√°c ƒë·ªÉ s·ª≠ d·ª•ng khi t·∫°o truy v·∫•n li√™n quan t·ª´ m√¥ h√¨nh li√™n k·∫øt.
- `limit_choices_to`: T√πy ch·ªçn n√†y cho ph√©p b·∫°n gi·ªõi h·∫°n c√°c ƒë·ªëi t∆∞·ª£ng c√≥ th·ªÉ ƒë∆∞·ª£c ch·ªçn khi t·∫°o m·ªôt m·ªëi quan h·ªá.
- `parent_link`: N·∫øu b·∫°n ƒë·∫∑t t√πy ch·ªçn n√†y th√†nh `True`, Django s·∫Ω t·∫°o m·ªôt li√™n k·∫øt ng∆∞·ª£c t·ª´ m√¥ h√¨nh con ƒë·∫øn m√¥ h√¨nh cha trong m·ªôt m√¥ h√¨nh k·∫ø th·ª´a.
- `to_field`: T√πy ch·ªçn n√†y cho ph√©p b·∫°n ch·ªâ ƒë·ªãnh m·ªôt tr∆∞·ªùng kh√°c (kh√¥ng ph·∫£i l√† kh√≥a ch√≠nh) ƒë·ªÉ s·ª≠ d·ª•ng l√†m m·ª•c ti√™u cho m·ªëi quan h·ªá.



## üíõ C·∫≠p nh·∫≠t thay ƒë·ªïi Models

M·ªói l·∫ßn b·∫°n thay ƒë·ªïi c·∫•u tr√∫c Model, b·∫°n ph·∫£i th·ª±c hi·ªán tu·∫ßn t·ª± c√°c l·ªánh sau ƒë·ªÉ c·∫≠p nh·∫≠t thay ƒë·ªïi l√™n Database

```bash
#Window
py manage.py makemigrations app_name
py manage.py migrate
#MacOS, Ubuntu
python manage.py makemigrations app_name
python manage.py migrate
```

## üíõ X√≥a m·ªôt Model ƒë√£ t·∫°o

ƒê·ªÉ x√≥a m·ªôt Model ƒë√£ ƒë·ªãnh nghƒ©a trong Django, b·∫°n c·∫ßn th·ª±c hi·ªán c√°c b∆∞·ªõc sau:

1. ƒê·∫£m b·∫£o kh√¥ng c√≥ app n√†o ƒëang s·ª≠ d·ª•ng model n√†y n·ªØa
2. X√≥a ho·∫∑c comment out class Model t∆∞∆°ng ·ª©ng trong file `models.py`.
3. Ch·∫°y l·ªánh `makemigrations` ƒë·ªÉ t·∫°o ra migration m·ªõi:

```bash
python manage.py makemigrations
```

4. Ch·∫°y l·ªánh `migrate` ƒë·ªÉ √°p d·ª•ng c√°c thay ƒë·ªïi v√†o c∆° s·ªü d·ªØ li·ªáu:

```bash
python manage.py migrate
```


L∆∞u √Ω r·∫±ng, vi·ªác x√≥a m·ªôt Model s·∫Ω x√≥a b·∫£ng t∆∞∆°ng ·ª©ng trong c∆° s·ªü d·ªØ li·ªáu, do ƒë√≥ t·∫•t c·∫£ d·ªØ li·ªáu trong b·∫£ng ƒë√≥ c≈©ng s·∫Ω b·ªã x√≥a. N·∫øu b·∫°n mu·ªën gi·ªØ l·∫°i d·ªØ li·ªáu, h√£y sao l∆∞u c∆° s·ªü d·ªØ li·ªáu tr∆∞·ªõc khi x√≥a Model.

Ngo√†i ra, n·∫øu Model b·∫°n mu·ªën x√≥a c√≥ m·ªëi quan h·ªá v·ªõi c√°c Model kh√°c th√¥ng qua ForeignKey ho·∫∑c c√°c tr∆∞·ªùng quan h·ªá kh√°c, b·∫°n c·∫ßn x·ª≠ l√Ω nh·ªØng m·ªëi quan h·ªá n√†y tr∆∞·ªõc khi x√≥a Model. C√°ch ti·∫øp c·∫≠n ph·ª• thu·ªôc v√†o y√™u c·∫ßu c·ª• th·ªÉ c·ªßa ·ª©ng d·ª•ng c·ªßa b·∫°n.


## üíõ Homeworks Guide

Th·ª±c h√†nh t·∫°o c√°c Model

- brands
- products
- customers
- stores
- staffs
- orders
- order_items
- stocks
